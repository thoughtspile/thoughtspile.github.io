<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    
      <meta name="google-site-verification" content="5nfOA5k_QcuAP9zbAASIV24DlAZG7BWxRVYoNlKCAoc" />
    
    <meta name="description" content="With all the enthusiasm around functional design in javascript community, we’ve come to reject the concepts whose names remind us of object-orientation. We throw constructors, methods and classes out">
<meta name="keywords" content="javascript,programming,OOP">
<meta property="og:type" content="article">
<meta property="og:title" content="OOP for FP lovers: Simplistic Dependency Injection">
<meta property="og:url" content="https://thoughtspile.github.io/2018/10/28/simplistic-di/index.html">
<meta property="og:site_name" content="Vladimir Klepov as a Coder">
<meta property="og:description" content="With all the enthusiasm around functional design in javascript community, we’ve come to reject the concepts whose names remind us of object-orientation. We throw constructors, methods and classes out">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-10-28T11:42:09.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OOP for FP lovers: Simplistic Dependency Injection">
<meta name="twitter:description" content="With all the enthusiasm around functional design in javascript community, we’ve come to reject the concepts whose names remind us of object-orientation. We throw constructors, methods and classes out">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>OOP for FP lovers: Simplistic Dependency Injection</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="Vladimir Klepov as a Coder" type="application/atom+xml" />
    

    <script type='text/javascript' src='//platform-api.sharethis.com/js/sharethis.js#property=5c1957fa423bba0012ec3bd1&product=inline-share-buttons'
      async='async'></script>

</head>

<body class="max-width mx-auto px3">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/thoughtspile">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2018/11/05/react-extend-justified/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2018/10/22/typescript-derived-interface/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://thoughtspile.github.io/2018/10/28/simplistic-di/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://thoughtspile.github.io/2018/10/28/simplistic-di/&text=OOP for FP lovers: Simplistic Dependency Injection"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://thoughtspile.github.io/2018/10/28/simplistic-di/&title=OOP for FP lovers: Simplistic Dependency Injection"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://thoughtspile.github.io/2018/10/28/simplistic-di/&is_video=false&description=OOP for FP lovers: Simplistic Dependency Injection"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=OOP for FP lovers: Simplistic Dependency Injection&body=Check out this article: https://thoughtspile.github.io/2018/10/28/simplistic-di/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://thoughtspile.github.io/2018/10/28/simplistic-di/&title=OOP for FP lovers: Simplistic Dependency Injection"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://thoughtspile.github.io/2018/10/28/simplistic-di/&title=OOP for FP lovers: Simplistic Dependency Injection"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://thoughtspile.github.io/2018/10/28/simplistic-di/&title=OOP for FP lovers: Simplistic Dependency Injection"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://thoughtspile.github.io/2018/10/28/simplistic-di/&title=OOP for FP lovers: Simplistic Dependency Injection"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://thoughtspile.github.io/2018/10/28/simplistic-di/&name=OOP for FP lovers: Simplistic Dependency Injection&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#We-Have-a-Problem"><span class="toc-number">1.</span> <span class="toc-text">We Have a Problem</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#STEP-Enter-DI"><span class="toc-number">2.</span> <span class="toc-text">STEP! Enter DI.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Are-We-Done-Yet"><span class="toc-number">3.</span> <span class="toc-text">Are We Done Yet?</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        OOP for FP lovers: Simplistic Dependency Injection
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Vladimir Klepov as a Coder</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-10-28T12:28:01.000Z" itemprop="datePublished">28.10.2018</time>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/OOP/">OOP</a>, <a class="tag-link" href="/tags/javascript/">javascript</a>, <a class="tag-link" href="/tags/programming/">programming</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>With all the enthusiasm around functional design in javascript community, we’ve come to reject the concepts whose names remind us of object-orientation. We throw constructors, methods and classes out of the window because they seem to smell of bank cubicles, water coolers and ERP. I’ve been on that train, but now I’m free from the prejudice. Great, useful ideas are hidden inside the fancy OOP terming, and I’m here to expose their niceness. We shall begin with Dependency Injection.</p>
<h2 id="We-Have-a-Problem"><a href="#We-Have-a-Problem" class="headerlink" title="We Have a Problem"></a>We Have a Problem</h2><p>I hear your teeth cringe as dusty IoC containers and AngularJS fly around your head. Take a deep breath and bear with me. Let’s write a module, say, a User service, that <em>depends</em> on other modules — a requester and the config. Normally, we code it along the lines of (for some imaginary redux-like state manager):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getUserList &#125; <span class="keyword">from</span> <span class="string">'./getUserList'</span>;</span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  pageSize: <span class="number">10</span>,</span><br><span class="line">  host: <span class="string">'192.168.0.0'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> initState = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">users</span>: [] &#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">loadNextUsers</span>(<span class="params">state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getUserList(&#123;</span><br><span class="line">    limit: config.pageSize,</span><br><span class="line">    offset: state.users.length,</span><br><span class="line">    host: config.host,</span><br><span class="line">  &#125;).then(<span class="function"><span class="params">nextUsers</span> =&gt;</span> &#123;</span><br><span class="line">    state.users.push(...nextUsers);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>The dependency structure of this app is set in stone, allowing no fiddling. It causes two classic problems. The module is not too reusable: we can’t customize the page size or host when loading the users. Testablity could be better, too: while we could have a <code>getUserList.mock.js</code> lying around for testing, replacing <code>config</code> in module’s internal scope is probably excessively tricky, even if possible.</p>
<h2 id="STEP-Enter-DI"><a href="#STEP-Enter-DI" class="headerlink" title="STEP! Enter DI."></a>STEP! Enter DI.</h2><p>If we have <em>dependencies</em>, we can <em>inject</em> them! All it takes in our functional example is passing them to <code>loadNextUsers</code> as a parameter:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> initState = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">users</span>: [] &#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">loadNextUsers</span>(<span class="params">state, getUserList, config</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getUserList(&#123;</span><br><span class="line">    limit: config.pageSize,</span><br><span class="line">    offset: state.users.length,</span><br><span class="line">    host: config.host,</span><br><span class="line">  &#125;).then(<span class="function"><span class="params">nextUsers</span> =&gt;</span> &#123;</span><br><span class="line">    state.users.push(...nextUsers);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>That’s not a huge change: instead of explicitly specifying and importing the dependencies inside a module, we do it one level above. By the way, <code>state</code> was injectable from the beginnning, allowing us to play with it or create multiple instances.</p>
<p>At first, it might seem like added verbosity and bookkeeping. But hey, look at the upsides! Now we can override the config as much as we like when loading the users: vary page size and the host (frankly, the host setting is a bit silly, but I couldn’t think of anything better — just pretend it’s super useful).</p>
<p>Testing becomes a joy. Instead of using a magic loader that takes not-the-module-we-specify-but-the-one-with-<code>.mock</code>-added-if-there-is-one, we can just call our function directly with a mocked dependency, using <a href="https://www.node-tap.org/" target="_blank" rel="noopener">node-tap</a> or even a bunch of <code>assert</code>s.</p>
<p>And the best thing is — we can use the explicit dependencies from the first example as default parameters, combining the best of both approaches.</p>
<p>This spirit of DI is what separates</p>
<ul>
<li><code>sum([1,2,3,4])</code> from <code>reduce([1,2,3,4], (x, y) =&gt; x + y, 0)</code> — we <em>inject</em> the reducer and the initial value.</li>
<li><code>mongoose</code> from <code>new Mongoose()</code> — this is brilliant API design, giving you ease of use for the 90% use case while providing an escape hatch to <em>inject</em> <a href="https://stackoverflow.com/questions/19474712/mongoose-and-multiple-database-in-single-node-js-project#19475270" target="_blank" rel="noopener">multiple databases</a> if you need to.</li>
<li><code>alias: { &#39;react&#39;: &#39;preact-compat&#39; }</code> in webpack from <code>@tappable({ h })</code> — yes, JSX-based helper libraries would have made us a favor by allowing to <em>inject</em> the JSX provider instead of relying on bundler trickery.</li>
</ul>
<h2 id="Are-We-Done-Yet"><a href="#Are-We-Done-Yet" class="headerlink" title="Are We Done Yet?"></a>Are We Done Yet?</h2><p>Our homegrown DI is not perfect — it has problems of its own compared to real IoC containers, such as <a href="http://inversify.io/" target="_blank" rel="noopener">InversifyJS</a>. The more stuff we inject, the more positional arguments we have to pass around, which becomes painful. Moreover, somewhere in our code we are still bound to the physical location of source modules, importing and repeating ourselver over and over. So yes, real, unhip, enterprise flavor of DI solves real problems.</p>
<hr>
<p>Please take some time to think it all over. DI is good. OOP is even better. They have non-hacky solutions to real challenges. Had it for over 20 years now, just sitting around. FP is good, too, for the same reason — not because of <em>elegance</em>, whatever that means. Meanwhile, I’ll try to write more on the merits of loosely-understood OOP, so make sure to come back!</p>

  </div>
  <div class="call-to-action clearfix">
    
      <a class="call-to-action__item left" href="/2018/10/22/typescript-derived-interface/">
        <i class="fas fa-chevron-left fa-3x"></i>
        <span class="call-to-action__item__name">Angular Tip: Derived Interfaces in TypeScript</span>
      </a>
    
    
      <a class="call-to-action__item right" href="/2018/11/05/react-extend-justified/">
        <span class="call-to-action__item__name">Why you Might Want to Extend React Components</span>
        <i class="fas fa-chevron-right fa-3x"></i>
      </a>
    
  </div>
</article>
<div class="sharethis-inline-share-buttons"></div>

    
        <div class="blog-post-comments">
            <div id="disqus_thread">
                <noscript>Please enable JavaScript to view the comments.</noscript>
            </div>
        </div>
    



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/thoughtspile">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#We-Have-a-Problem"><span class="toc-number">1.</span> <span class="toc-text">We Have a Problem</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#STEP-Enter-DI"><span class="toc-number">2.</span> <span class="toc-text">STEP! Enter DI.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Are-We-Done-Yet"><span class="toc-number">3.</span> <span class="toc-text">Are We Done Yet?</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://thoughtspile.github.io/2018/10/28/simplistic-di/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://thoughtspile.github.io/2018/10/28/simplistic-di/&text=OOP for FP lovers: Simplistic Dependency Injection"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://thoughtspile.github.io/2018/10/28/simplistic-di/&title=OOP for FP lovers: Simplistic Dependency Injection"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://thoughtspile.github.io/2018/10/28/simplistic-di/&is_video=false&description=OOP for FP lovers: Simplistic Dependency Injection"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=OOP for FP lovers: Simplistic Dependency Injection&body=Check out this article: https://thoughtspile.github.io/2018/10/28/simplistic-di/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://thoughtspile.github.io/2018/10/28/simplistic-di/&title=OOP for FP lovers: Simplistic Dependency Injection"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://thoughtspile.github.io/2018/10/28/simplistic-di/&title=OOP for FP lovers: Simplistic Dependency Injection"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://thoughtspile.github.io/2018/10/28/simplistic-di/&title=OOP for FP lovers: Simplistic Dependency Injection"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://thoughtspile.github.io/2018/10/28/simplistic-di/&title=OOP for FP lovers: Simplistic Dependency Injection"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://thoughtspile.github.io/2018/10/28/simplistic-di/&name=OOP for FP lovers: Simplistic Dependency Injection&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 Vladimir Klepov
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/thoughtspile">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-121445688-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'thoughtspile';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


