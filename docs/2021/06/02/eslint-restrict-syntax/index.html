<!doctype html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="yandex-verification" content="635edef3908320be"><meta name="google-site-verification" content="5nfOA5k_QcuAP9zbAASIV24DlAZG7BWxRVYoNlKCAoc"><meta name="color-scheme" content="dark light"><meta property="og:type" content="article"><meta property="og:title" content="Become the master of your eslint with no-restricted-syntax"><meta property="og:url" content="https://thoughtspile.github.io/2021/06/02/eslint-restrict-syntax/"><meta property="og:site_name" content="Vladimir Klepov as a Coder"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://thoughtspile.github.io/images/main-promo.png"><meta property="article:published_time" content="2021-06-02T00:00:00.000Z"><meta property="article:author" content="Vladimir Klepov"><meta property="article:tag" content="eslint"><meta property="article:tag" content="infra"><meta property="article:tag" content="programming"><meta property="article:tag" content="javascript"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@thoughtspile"><meta name="twitter:image" content="https://thoughtspile.github.io/images/main-promo.png"><title>Become the master of your eslint with no-restricted-syntax</title><link rel="stylesheet" href="/css/style.css?ts=1708188942854"><link rel="canonical" href="https://thoughtspile.github.io/2021/06/02/eslint-restrict-syntax/"><link rel="alternate" href="/atom.xml" title="Vladimir Klepov as a Coder" type="application/atom+xml"><script defer="defer" data-domain="thoughtspile.github.io" src="https://t.thoughtspile.tech/js/script.js"></script></head><body class="max-width mx-auto px3"><div class="content index"><a href="/" id="header" class="header header--post"><div id="logo"></div><header id="title"><h1>Vladimir Klepov as a Coder</h1></header></a><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Become the master of your eslint with no-restricted-syntax</h1><div class="post__date">Written in <time>2021</time></div></header><div class="content" itemprop="articleBody"><p>The other day I was doing my normal thing trying to force <code>import '*.css'</code> to be the last import in a file, which ensures a predicatbale CSS order. I spent hours looking for a eslint plugin to do that, but with little luck. Without getting into too much details:</p><ul><li>The <a href="https://eslint.org/docs/rules/sort-imports" target="_blank" rel="noopener">built-in <code>sort-imports</code></a> can only group by syntax (eg <code>import { a, b }</code> before <code>import def</code>) — weird.</li><li><a href="https://github.com/benmosher/eslint-plugin-import/blob/master/docs/rules/order.md" target="_blank" rel="noopener"><code>eslint-plugin-import/order</code></a> has a more useful grouping, but ignores side-effect imports (just like out <code>import '*.css'</code>).</li><li>The amazing <a href="https://github.com/lydell/eslint-plugin-simple-import-sort/" target="_blank" rel="noopener"><code>eslint-plugin-simple-import-sort</code></a> is tweakable enough to detect CSS imports, but also forces alphabetic order on all other imports.</li></ul><p>I got entrenched in an argument about alphabetizing imports, so the issue was swept under the rug for a while. Just as I was about to write a custom plugin, the help arrived in the form of <a href="https://eslint.org/docs/rules/no-restricted-syntax" target="_blank" rel="noopener"><code>no-restricted-syntax</code> — an amazing eslint rule</a> that allows you to enforce almost anything, including my CSS import ordering. It lets you describe the code you don't want using ESQuery, a CSS-selector-like query language for ES AST. Sounds fancy and complicated, but if you know CSS (as a front-end developer, you probably do), you quickly get the hang of it.</p><p>Let's walk through an example, forcing CSS imports to be last:</p><ol><li><code>ImportDeclaration</code> matches the AST node for <code>import ...;</code>. A good start, but too loose.</li><li>To be more specific, we match only imports of files with <code>.css</code> extension using the amazing regex attribute selector: <code>ImportDeclaration[source.value=/\\.css$/]</code> Much better, but we don't want to ban all CSS imports.</li><li>Finally, we can find (watch closely) imports following a CSS import with general sibling selector <code>ImportDeclaration[source.value=/\\.css$/i] ~ ImportDeclaration[source.value!=/\\.css$/i]</code> and ban them!</li></ol><p>All in all, we end up with</p><pre class="language-json"><code class="language-json"><span class="token property">"no-restricted-syntax"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><br>    <span class="token property">"selector"</span><span class="token operator">:</span> <span class="token string">"ImportDeclaration[source.value=/\\.css$/i] ~ ImportDeclaration[source.value!=/\\.css$/i]"</span><span class="token punctuation">,</span><br>    <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"CSS import must be last"</span><br><span class="token punctuation">}</span><span class="token punctuation">]</span></code></pre><p>The warning is shown on imports following the CSS import, not the CSS import itself. Not ideal, but it's is a tradeoff you have to make since ESQuery selectors can't look ahead in the tree, just like CSS. On a bright note, you can use the dope <a href="https://drafts.csswg.org/selectors-4/#has-pseudo" target="_blank" rel="noopener">CSS4 <code>:has</code> selector,</a> which is not supported in any browser yet.</p><p>Two resources I find helpful when working with <code>no-restricted-syntax</code> are:</p><ul><li><a href="https://esprima.org/demo/parse.html" target="_blank" rel="noopener">Esprima demo</a> prints the AST for a JS snippet you provide. Very handy to see what node types and attributes the AST has.</li><li><a href="https://github.com/estools/esquery" target="_blank" rel="noopener">ESQuery docs</a> describe the supported AST selectors with links to their CSS counterparts. There's also a <a href="https://estools.github.io/esquery/" target="_blank" rel="noopener">live playground</a> that lets you try the selectors in a browser, but it doesn't work that great.</li></ul><p>More and more often I find that writing a quick query for <code>no-restricted-syntax</code> is faster and simpler than looking for a plugin that does what you want, and then configuring it. Hell, it's even easier than trying to recall the name of a built-in rule that you know exists.</p><p>Even when a rule <em>is</em> available and you remember the name, <code>no-restricted-syntax</code> may offer some benefits:</p><ul><li>More maintainable, as in <code>MemberExpression[property.name=/^(add|remove)EventListener$/]</code> vs <a href="https://eslint.org/docs/rules/no-restricted-properties" target="_blank" rel="noopener"><code>no-restricted-properties</code></a> with several copies of the rule to ban explicit <code>addEventListener</code> and <code>removeEventListener</code>.</li><li>More flexible, as in <code>MemberExpression[property.name=/^(add|remove)EventListener$/][object.name!=/^(document|window)$/]</code> that <em>only</em> allows explicit listeners on <code>document</code> and <code>window</code>.</li></ul><p>As with anything, there are some weaker points:</p><ul><li>ESQuery (and regexes) do have a learning curve, and other team members may struggle with editing the rules.</li><li>Autofix is clearly not available.</li><li>You can't disable a specific restriction per line with <code>/* eslint-disable */</code>, only the whole rule.</li><li>A minor inconvenience (or my stupidity), but I could not get slashes in regex attribute matchers to work no matter how much I escaped them (and I went all the way from <code>/</code> to <code>\\\\/</code>).</li></ul><hr><p>Overall, <code>no-restricted-syntax</code> is a very cool rule. It covers probably 95% of the cases where you might want a custom eslint plugin. If you ever wanted to ban some pretty specific thing, but abandoned that idea after a fruitless search for a fitting eslint plugin, it might be your turn to give it a shot!</p><p>ESQuery is not almighty — you still can't match across multiple modules or maintain a complex context. Is it time to write a plugin for that? Probably not — stay tuned for my next post on working around eslint limitations!</p></div><span class="share"><div><a href="https://twitter.com/share?url=https://thoughtspile.github.io/2021/06/02/eslint-restrict-syntax/&text=Become the master of your eslint with no-restricted-syntax by @thoughtspile" target="_blank" rel="noopener">Tweet</a></div><div id="share-button"><a>Share</a></div><div><a href="https://twitter.com/search?q=https://thoughtspile.github.io/2021/06/02/eslint-restrict-syntax/" target="_blank" rel="noopener">Discuss on Twitter</a></div></span><div class="social-links"><a href="https://www.linkedin.com/in/vklepov/" class="link--bare" target="_blank" rel="noopener"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a href="https://github.com/thoughtspile" class="link--bare" target="_blank" rel="noopener"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="/atom.xml" class="link--bare" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="rss" class="svg-inline--fa fa-rss fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 64C0 46.3 14.3 32 32 32c229.8 0 416 186.2 416 416c0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96C14.3 96 0 81.7 0 64zM128 416c0 35.3-28.7 64-64 64s-64-28.7-64-64s28.7-64 64-64s64 28.7 64 64zM32 160c159.1 0 288 128.9 288 288c0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224c-17.7 0-32-14.3-32-32s14.3-32 32-32z"></path></svg></a></div><a href="https://buymeacoffee.com/thoughtspile" class="link--bare bmc-card" target="_blank" rel="noopener"><div><b>Hello, friend!</b> My name is Vladimir, and I love writing about web development. If you got down here, you probably enjoyed this article. My goal is to become an independent content creator, and you'll help me get there by <span class="bmc">buying me a coffee!</span></div><img src="/images/bmc.png" data-no-preview class="bmc-image"></a><div class="post-related"><div class="post-sibling"><span class="post-siblings__direction">More?</span> <a class="tag-link-link" href="/">All articles ever</a> <a class="tag-link-link" href="/tags/eslint" rel="tag">eslint</a> <a class="tag-link-link" href="/tags/infra" rel="tag">infra</a> <a class="tag-link-link" href="/tags/programming" rel="tag">programming</a> <a class="tag-link-link" href="/tags/javascript" rel="tag">javascript</a></div><a class="link--bare post-sibling" href="/2021/05/31/moar-coverage/"><span class="post-siblings__direction">Older?</span> <span class="link__text">How to increase test coverage FAST</span> </a><a class="link--bare post-sibling" href="/2021/06/04/eslint-workarounds/"><span class="post-siblings__direction">Newer?</span> <span class="link__text">Go beyond eslint limits with these 3 tricks</span></a></div></article><script async src="/js/share.js"></script></div></body></html>