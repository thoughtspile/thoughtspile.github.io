<!doctype html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="yandex-verification" content="635edef3908320be"><meta name="google-site-verification" content="5nfOA5k_QcuAP9zbAASIV24DlAZG7BWxRVYoNlKCAoc"><meta name="color-scheme" content="dark light"><meta property="og:type" content="article"><meta property="og:title" content="Can we useRef, but without the .current? Let&#39;s try!"><meta property="og:url" content="https://thoughtspile.github.io/2021/10/25/useref-no-current/"><meta property="og:site_name" content="Vladimir Klepov as a Coder"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://thoughtspile.github.io/images/cat-ref.jpg"><meta property="article:published_time" content="2021-10-25T00:00:00.000Z"><meta property="article:author" content="Vladimir Klepov"><meta property="article:tag" content="react"><meta property="article:tag" content="hooks"><meta property="article:tag" content="javascript"><meta property="article:tag" content="frontend"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@thoughtspile"><meta name="twitter:image" content="https://thoughtspile.github.io/images/cat-ref.jpg"><title>Can we useRef, but without the .current? Let&#39;s try!</title><link rel="stylesheet" href="/css/style.css?ts=1708189105401"><link rel="canonical" href="https://thoughtspile.github.io/2021/10/25/useref-no-current/"><link rel="alternate" href="/atom.xml" title="Vladimir Klepov as a Coder" type="application/atom+xml"><script defer="defer" data-domain="thoughtspile.github.io" src="https://t.thoughtspile.tech/js/script.js"></script></head><body class="max-width mx-auto px3"><div class="content index"><a href="/" id="header" class="header header--post"><div id="logo"></div><header id="title"><h1>Vladimir Klepov as a Coder</h1></header></a><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Can we useRef, but without the .current? Let&#39;s try!</h1><div class="post__date">Written in <time>2021</time></div></header><div class="content" itemprop="articleBody"><p>Ah, <code>ref.current</code>. Everybody knows that I love <code>useRef</code> — I've <a href="/2021/04/05/useref-usememo/">built custom <code>useMemo</code> with it,</a> and I've used it <a href="/2021/10/18/non-react-state/">instead of <code>useState</code> to optimize re-renders.</a> But typing <code>ref.current</code> over and over is just annoying. Come on, Vladimir, <code>startX.current</code> is just the same as <code>this.startX</code> in a class, I told myself a million times, but it just doesn't work.</p><p>I think <code>ref.current</code> annoys me because it exists just to please the computer — I mean, mr. React, do you think I want a <code>.stale</code> value, or a <code>.future</code> one? Of course I'd like <code>.current</code>, could you please get it for me? Doing <em>any</em> work that can (or feels like it can) be automated is always annoying — you know what I mean if you ever had to write ES5 code without babel or struggled to sort imports for eslint without <code>--fix</code>.</p><p>In today's article, we embark on a journey to kill all <code>.current</code> (or at least <em>some</em>). We'll understand why it exists in the first place, see some practical cases when it can be avoided, and then, just for entertainment, see what the world wihout <code>.current</code> could have been.</p><h2>Why do we need ref.curernt at all?</h2><p>A brief recap if you're unsure why <code>useRef</code> exists. React function component is, obviously, a JS function that accepts <code>props</code> as an argument and returns some vDOM. Different props come in through an argument, so you might guess that React calls that function on every render:</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Clicker</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// one call = one render</span><br>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>But if you declare a <code>let</code> variable in your component, it will be re-initialized to its initial value on every render, forgetting anything you may have assigned to it. Here, <code>clicks</code> will be back to zero if <code>Clicker</code>'s parent re-renders:</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Clicker</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> clicks <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>clicks<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><span class="token punctuation">}</span></code></pre><p>Moving the declaration outside the function solves the reset issue, but now all instances of our component share the same value, which is probably not what you want:</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">let</span> clicks <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><span class="token keyword">function</span> <span class="token function">Clicker</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// total number of clicks on all Clickers in our app ever</span><br>  <span class="token keyword">const</span> <span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>clicks<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><span class="token punctuation">}</span></code></pre><p>Hence, react has a <code>useRef</code> hook that magically stores one value per component instance and persists it between re-renders:</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Clicker</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> clicks <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>clicks<span class="token punctuation">.</span>current<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><span class="token punctuation">}</span></code></pre><p>Note that the value we care about now lives in a <code>.current</code> property of some object. This solves two problems:</p><ul><li>React can't capture a new value from <code>clicks = clicks + 1</code>, since you can't observe assignments in JS.</li><li>The <em>wrapper object,</em> also known as a <em>box,</em> has a constant reference that lets callbacks cached in past renders read a &quot;value from the future&quot; — otherwise, they'd be stuck with a stale one.</li></ul><p>So, <code>useRef</code> lets us persist a mutable value between re-renders by putting it into a <code>current</code> property of a constant-reference box object. Looks like every part is necessary. But what if we don't always need to carry the whole box around?</p><p><img src="/images/cat-ref.jpg" alt=""></p><h2>Skip .current for constants</h2><p>If the value wrapped in <code>useRef</code> actually never changes, we can dereference right in the declaration:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>clicks<span class="token punctuation">,</span> setClicks<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> onClick <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setClicks</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> c<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span><br><span class="token comment">// now we can just</span><br>onClick<span class="token operator">=</span><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span><br><span class="token comment">// instead of</span><br>onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> onClick<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>This works because you never assign current, and don't need the <em>box</em> to preserve the reference because the inner reference is just as stable. Whether you should use this to cache callbacks or just <code>useCallback</code> is another question. Anyways, this works for any value you'd like to reliably cache forever:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> initialValue <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span><br><span class="token keyword">return</span> <span class="token operator">&lt;</span>input<br>  data<span class="token operator">-</span>changed<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>value <span class="token operator">!==</span> initialValue<span class="token punctuation">}</span><br>  <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span><br><span class="token operator">/</span><span class="token operator">></span></code></pre><p>Don't carry the box around if the contents never change.</p><h2>Skip .current for mutable objects</h2><p>Storing constant values in a ref is not the most obscure use case, but still a fairly specialized one. But when you're storing a mutable object in a ref without reassigning it, you're still working with a <em>constant</em> — sure, the contents of your object change, but the reference is stable, so the trick above still applies. If you feel like this is against hooks, or will cause any trouble, please see <a href="/2021/10/11/usestate-object-vs-multiple/">my older post on <code>useState(object)</code> vs many <code>useStates</code></a> (spoiler: it's OK and even preferable for related values).</p><p>For instance, here's what I often use for gesture tracking:</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Swiper</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> gesture <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token literal-property property">startX</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">startY</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">startT</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token function-variable function">onStart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token comment">// ah, it's so nice to skip gesture.current.startX</span><br>    gesture<span class="token punctuation">.</span>startX <span class="token operator">=</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX<span class="token punctuation">;</span><br>    gesture<span class="token punctuation">.</span>startY <span class="token operator">=</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY<span class="token punctuation">;</span><br>    gesture<span class="token punctuation">.</span>startT <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token function-variable function">onMove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> x <span class="token operator">=</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX<span class="token punctuation">;</span><br>    <span class="token keyword">const</span> y <span class="token operator">=</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY<span class="token punctuation">;</span><br>    <span class="token comment">// no .current is amazing</span><br>    el<span class="token punctuation">.</span>current<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x <span class="token operator">-</span> gesture<span class="token punctuation">.</span>startX<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y <span class="token operator">-</span> gesture<span class="token punctuation">.</span>startY<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,0)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><br>    <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>el<span class="token punctuation">}</span></span><br>    <span class="token attr-name">onTouchStart</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onStart<span class="token punctuation">}</span></span><br>    <span class="token attr-name">onTouchMove</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onMove<span class="token punctuation">}</span></span><br>    <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>We've grouped the three variables we track during a gesture into a single object ref. I think it's more convenient, and communicates the intent better than just having some separate refs floating around your code with no clear relationship.</p><p>So, if your ref contents is a <em>box</em> itself, you don't need one more box to carry the first one around. Also, if you have several related refs anyways, why not put them into one box?</p><h2>Fragile corner-cases</h2><p>That's it for the stuff I use frequently. There are two more cases that work the same with or without a <code>useRef</code>, but they're very fragile and I wouldn't rely on these. Still, they'd be interesting to cover.</p><h3>Constant component</h3><p>OK, <code>let</code> variable resets on re-render. Then, if our component <em>never</em> re-renders, maybe we're safe skip the <code>useRef</code> and just use a <code>let</code>:</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> Icon <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> clicks <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    clicks<span class="token operator">++</span><span class="token punctuation">;</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>clicks<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SomeStaticSVG</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Not <em>using</em> any props in a component and slapping a <code>memo</code> on it is not enough — we could pass a useless prop and change it, like <code>&lt;Icon gotcha={Math.random()} /&gt;</code> — React doesn't know if we care for <code>gotcha</code>. An extra hint in our memo comparator does the job. Hooks that can re-render our component are a no-go, too — <code>useState</code>, <code>useReducer</code>, <code>useContext</code>, or any custom hooks based on these.</p><p>Components like this one are not as useless as you might think — I've actually made an optimized icon pack with a similar pattern. Still, the lack of props is very limiting. But the major problem with this code is that React doesn't give any guarantees about <code>memo</code> — at some point it might start discarding old values to free memory, resetting your precious clicks. Dangerous!</p><h3>Constant callbacks</h3><p>A slightly more practical (yet still sloppy) scenario is using a <em>ref</em> only inside callbacks that are created in the first render and cached forever. Yes, we reset the value on every render, but who cares if all the function that use it are stuck in the scope of the first render:</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Swiper</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> clicks <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> onClick <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    clicks<span class="token operator">++</span><span class="token punctuation">;</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>clicks<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">click me</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><span class="token punctuation">}</span></code></pre><p><code>useCallback(..., [])</code> won't cut it, since, again, react does not actually guarantee it will cache forever. With an explicit constant <code>useRef</code> we're safe, but the whole thing explodes if you ever need to capture a state/props in a callback, and rewrite it to <code>useCallback</code> or remove caching altogether. Not recommended.</p><h2>Going beyond with objects.</h2><p>For the sake of an argument, let's assume I find <code>.current</code> absolutely inacceptable for religious reasons. What could I do to never type it again? There's a whole bunch of solutions if I'm really determined.</p><p>A least adventurous option is a custom hook that's just like a default ref, but replaces <code>current</code> with a different name. <code>v</code> is fine — it's short, it stands for Value, and it's a fine-looking letter. Here we go:</p><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// inner object is the ref-box now</span><br><span class="token keyword">const</span> <span class="token function-variable function">useV</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">init</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">v</span><span class="token operator">:</span> init <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span><br><span class="token comment">// use as follows</span><br><span class="token keyword">const</span> startX <span class="token operator">=</span> <span class="token function">useV</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><br>  <span class="token attr-name">onTouchStart</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> startX<span class="token punctuation">.</span>v <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX<span class="token punctuation">}</span></span><br>  <span class="token attr-name">onTouchMove</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setOffset</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> startX<span class="token punctuation">.</span>v<span class="token punctuation">)</span><span class="token punctuation">}</span></span><br>  <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>offset<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><br><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>But that's boring. What if we always put all the refs in a component into a large object? Anything we can do with multiple refs is doable with a single one. Looks like something a person who hates hooks but is forced to use them could do:</p><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// hope you're old enough to get this hommage</span><br><span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">startX</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>  <span class="token comment">// WOW we can even have CLASS METHODS back!</span><br>  <span class="token function">onTouchStart</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>startX <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token function">onTouchMove</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// And call state update handles since they're stable</span><br>    <span class="token function">setOffset</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startX<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span><br><span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><br>  <span class="token attr-name">onTouchStart</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>that<span class="token punctuation">.</span>onTouchStart<span class="token punctuation">}</span></span><br>  <span class="token attr-name">onTouchMove</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>that<span class="token punctuation">.</span>onTouchMove<span class="token punctuation">}</span></span><br>  <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>offset<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><br><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>The fact that we can have <em>methods</em> on that large stateful object is very exciting. On a sadder note, we can't read current props or state, because they don't have a stable reference. We could start copying props into <code>that</code>, but the very idea of &quot;current props&quot; <a href="https://github.com/facebook/react/pull/18545" target="_blank" rel="noopener">gets fuzzy</a> once you enter concurrent mode, and I'm not going to die on this (ha, <code>this</code>) hill, or at least not today.</p><p>In an unexpected twist, we could even move ref management into a HOC. Remember <a href="https://reactjs.org/docs/react-without-es6.html" target="_blank" rel="noopener">createReactClass?</a> Well, it's back:</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">makeComponent</span> <span class="token operator">=</span> <span class="token parameter">descriptor</span> <span class="token operator">=></span> <span class="token parameter">props</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> scope <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span><br>  <span class="token keyword">return</span> scope<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> Swiper <span class="token operator">=</span> <span class="token function">makeComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token comment">// you can't use arrows because you need "this"</span><br>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// any hooks in render() are OK:</span><br>    <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onClick<span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">clicks</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>  <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>clicks<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Apart from the missing props / state access, these solutions have other downsides:</p><ul><li>We create an extra object on each render and throw it away. A custom lazy-initializing <code>useRef</code> can work around that, though.</li><li>Like all object-based code, they minify a bit worse than &quot;atomic refs&quot;, because property names are not mangled (see my earlier <a href="/2021/10/11/usestate-object-vs-multiple/">benchmark of atomic vs object state</a>).</li></ul><p>Anyways, <code>{ current }</code> is not the only object shape that could work as a ref. What else can we do?</p><h2>And even further with callbacks</h2><p>Objects are not the only JS thing that can be a stable container for a changing value. Let's try a function instead! (Don't get me started with <code>(() =&gt; {}) instanceof Object</code>, functions are clearly not objects). First, let's try a polymorphic handle that can both get and set the value:</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">useFunRef</span><span class="token punctuation">(</span><span class="token parameter">init</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>init<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> handle <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token comment">// if we pass an argument, update the value</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      ref<span class="token punctuation">.</span>current <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> ref<span class="token punctuation">.</span>current<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span><br>  <span class="token keyword">return</span> handle<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Using it is simple: you either call the handle with no arguments to get the current value, or with a new value to update:</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>offset<span class="token punctuation">,</span> setOffset<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> nodeRef <span class="token operator">=</span> <span class="token function">useFunRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> startX <span class="token operator">=</span> <span class="token function">useFunRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><br>  <span class="token attr-name">onTouchStart</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">startX</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX<span class="token punctuation">)</span><span class="token punctuation">}</span></span><br>  <span class="token attr-name">onTouchMove</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setOffset</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX <span class="token operator">-</span> <span class="token function">startX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><br>  <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>nodeRef<span class="token punctuation">}</span></span><br>  <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>offset<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><br><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>I like how this one integrates with DOM refs thanks to the callback-ref syntax. As an added advantage, functions should be faster to create (then throw away) than objects. And, since you're using more functions, your programming clearly becomes more functional.</p><p>If you don't like functions that do different things depending on the number of arguments, we can separate the getter and the setter, similarly to what <code>useState</code> does:</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">useStateRef</span><span class="token punctuation">(</span><span class="token parameter">init</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>init<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> setter <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=></span> ref<span class="token punctuation">.</span>current <span class="token operator">=</span> v<span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> getter <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> ref<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token punctuation">[</span>getter<span class="token punctuation">,</span> setter<span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><span class="token comment">// usage example</span><br><span class="token keyword">const</span> <span class="token punctuation">[</span>startX<span class="token punctuation">,</span> setStartX<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useStateRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><br>  <span class="token attr-name">onTouchStart</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setStartX</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX<span class="token punctuation">)</span><span class="token punctuation">}</span></span><br>  <span class="token attr-name">onTouchMove</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setOffset</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> <span class="token function">startX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><br><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>So yes, a function can be a ref-box, too. That's good to know. Is there anything else?</p><h2>Nothing can stop me now</h2><p>Until now, we've been playing with the <em>box</em> shape without straying too far from the overall concept. But maybe that's what we call &quot;a poultice for a dead man&quot; in Russia? (<em>English tip: a poultice is a warm bag of herbs used in traditional medicine. It surely won't help if you're dead. I learnt this word just to write this post.</em>) What if we don't need a box?</p><p>Component scope resets on every render. Fine, we need another scope to store our value. Module scope is too drastic — can we just get one that persists between re-renders, but is unique to every component? I'm the master of my scopes, so why not:</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">makeClicker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// this is the outer / instance scope</span><br>  <span class="token keyword">let</span> clicks <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>  <span class="token comment">// we can declare callbacks here</span><br>  <span class="token keyword">const</span> <span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>clicks<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token comment">// this is the inner / render scope</span><br>    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token keyword">function</span> <span class="token function">Clicker</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Now we need to manage the instance scope</span><br>  <span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token function">makeClicker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span><br>  <span class="token comment">// and turn it into a regular component</span><br>  <span class="token keyword">return</span> <span class="token function">render</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>While we're at it, more of the same can be done with a generator — sure, we can only <code>return</code> once, but why not <code>yield</code> our JSX on every render instead?</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">genClicker</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> clicks <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>clicks<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    props <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><br>      <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span></span><br>      <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span></span><br>    <span class="token punctuation">/></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token keyword">function</span> <span class="token function">Clicker</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token function">genClicker</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span><br>  <span class="token keyword">return</span> render<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>In both cases, we can't use hooks in the <em>outer scope</em>. If we were to turn <code>clicks</code> into state, we couldn't do it like this:</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">makeClicker</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>clicks<span class="token punctuation">,</span> setClicks<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setClicks</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>clicks<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>It doesn't explode, since we happen to call <code>useState</code> on every render (because we call <code>makeClicker</code> on every render and throw it away), but <code>clicks</code> will be stuck at 0 — it's a <code>const</code> from the first render. We're free to use hooks both in our <em>inner scope</em> and the <code>Swiper</code> wrapper, though. This also means that we can't use our outer refs to cache state update / dispatch handles, which I liked very much.</p><p>These concepts are very interesting, because they're in line with the hooks mindset: minimal object use (good for memory &amp; minification) and creative handling of JS scopes. At the same time, we don't need an object box to host our ref! Also, if we manage to build a <em>lazy ref</em> for out instance scope, we skip recreating useless variables and callbacks on every render, which is pleasant. The syntax and the limitations on hooks in the outer scope are sad, but I feel like they can be worked around (maybe something like <code>clicks = yield useGenState(0)</code>). Promising.</p><hr><p>In this article, we've seen why <code>useRef</code> has that weird <code>.current</code> property, and learnt some tricks to write <code>.current</code> less:</p><ul><li>Dereference constant values during creation: <code>const onClear = useRef(() =&gt; setValue('')).current;</code></li><li>Combine several <code>refs</code> into a mutable ref-object, and mutate that instead of <code>current</code>: <code>pos = useRef({ x: 0, y: 0 }).current</code>, read with <code>pos.x</code>, write with <code>pos.x = e.clientX()</code></li></ul><p>In some cases, you could drop the <code>useRef</code> and use a simple <code>let</code> variable instead, but I don't recommend it.</p><p>To stimulate our imagination, we've also implemented <em>seven</em> alternate APIs on top of the default <code>useRef</code> that don't use <code>.current</code>:</p><ul><li>One with an alternate property name: <code>useV(0).v</code></li><li><em>Stateful core</em> that's surprisingly similar to a class component.</li><li>A <code>makeComponent</code> factory that lets you put the render function, along with some properties and methods, into an object, yet still allows for hooks.</li><li>Two function-based <code>useRefs</code>: a <code>useState</code>-like one that has separate get and set handles: <code>const [getX, setX] = useStateRef(0)</code>, and one with a single handle.</li><li>A component with two scopes: one that persists throughout re-rendering and can host ref-like mutable variables, and one that actually renders the JSX. We've also made a similar one with generators.</li></ul><p>Maybe this wasn't very useful (I'm not eager to rewrite all my code using these patterns), but I hope it was great fun (it sure was for me). React is amazingly flexible, which is why I love it. Hope this mental exercise got you excited. See you later!</p></div><span class="share"><div><a href="https://twitter.com/share?url=https://thoughtspile.github.io/2021/10/25/useref-no-current/&text=Can we useRef, but without the .current? Let&#39;s try! by @thoughtspile" target="_blank" rel="noopener">Tweet</a></div><div id="share-button"><a>Share</a></div></span><div class="social-links"><a href="https://www.linkedin.com/in/vklepov/" class="link--bare" target="_blank" rel="noopener"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a href="https://github.com/thoughtspile" class="link--bare" target="_blank" rel="noopener"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="/atom.xml" class="link--bare" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="rss" class="svg-inline--fa fa-rss fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 64C0 46.3 14.3 32 32 32c229.8 0 416 186.2 416 416c0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96C14.3 96 0 81.7 0 64zM128 416c0 35.3-28.7 64-64 64s-64-28.7-64-64s28.7-64 64-64s64 28.7 64 64zM32 160c159.1 0 288 128.9 288 288c0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224c-17.7 0-32-14.3-32-32s14.3-32 32-32z"></path></svg></a></div><a href="https://buymeacoffee.com/thoughtspile" class="link--bare bmc-card" target="_blank" rel="noopener"><div><b>Hello, friend!</b> My name is Vladimir, and I love writing about web development. If you got down here, you probably enjoyed this article. My goal is to become an independent content creator, and you'll help me get there by <span class="bmc">buying me a coffee!</span></div><img src="/images/bmc.png" data-no-preview class="bmc-image"></a><div class="post-related"><div class="post-sibling"><span class="post-siblings__direction">More?</span> <a class="tag-link-link" href="/">All articles ever</a> <a class="tag-link-link" href="/tags/react" rel="tag">react</a> <a class="tag-link-link" href="/tags/hooks" rel="tag">hooks</a> <a class="tag-link-link" href="/tags/javascript" rel="tag">javascript</a> <a class="tag-link-link" href="/tags/frontend" rel="tag">frontend</a></div><a class="link--bare post-sibling" href="/2021/10/18/non-react-state/"><span class="post-siblings__direction">Older?</span> <span class="link__text">How to replace useState with useRef and be a winner</span> </a><a class="link--bare post-sibling" href="/2021/10/27/better-react-context/"><span class="post-siblings__direction">Newer?</span> <span class="link__text">Why I always wrap Context.Provider and useContext</span></a></div></article><script async src="/js/share.js"></script></div></body></html>