<!doctype html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="yandex-verification" content="635edef3908320be"><meta name="google-site-verification" content="1-m0w7Up8df1sn0230jxfTKKZ4jLeln_Em1tcyfU0qw"><meta name="color-scheme" content="dark light"><meta property="og:type" content="article"><meta property="og:title" content="Open source starter pack for JS devs"><meta property="og:url" content="https://thoughtspile.github.io/2021/11/20/open-source-starter/"><meta property="og:site_name" content="Vladimir Klepov as a Coder"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://thoughtspile.github.io/images/oss-scream.jpg"><meta property="og:image" content="https://thoughtspile.github.io/images/no-dts.png"><meta property="article:published_time" content="2021-11-20T00:00:00.000Z"><meta property="article:author" content="Vladimir Klepov"><meta property="article:tag" content="open source"><meta property="article:tag" content="javascript"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@thoughtspile"><meta name="twitter:image" content="https://thoughtspile.github.io/images/oss-scream.jpg"><title>Open source starter pack for JS devs</title><link rel="stylesheet" href="/css/style.css?ts=1705835725265"><link rel="canonical" href="https://thoughtspile.github.io/2021/11/20/open-source-starter/"><link rel="alternate" href="/atom.xml" title="Vladimir Klepov as a Coder" type="application/atom+xml"><script defer="defer" data-domain="thoughtspile.github.io" src="https://t.thoughtspile.tech/js/script.js"></script></head><body class="max-width mx-auto px3"><div class="content index"><a href="/" id="header" class="header header--post"><div id="logo"></div><header id="title"><h1>Vladimir Klepov as a Coder</h1></header></a><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Open source starter pack for JS devs</h1><div class="post__date">Written in <time>2021</time></div></header><div class="content" itemprop="articleBody"><p>So you've decided to open-source your project. Amazing! Bad news first: writing code is only the beginning. The information for library authors on the web is surprisingly fragmented, so I've decided to put together a list of things to keep in mind when open-sourcing a JS library:</p><ul><li>Decent docs, an OSS license, TypeScript definitions and a changelog are a must if you want anyone to use your library.</li><li>Build setup of a library is different from that of an app — but even simpler, if you know what to do.</li><li><code>peerDependenies</code> are a thing (also, npm / yarn version resolution is a nightmare).</li></ul><p>I'll give you enough info on each point to get started without going too deep.</p><p>I assume you're comfortable with <a href="https://babeljs.io/" target="_blank" rel="noopener">babel</a> and <a href="https://webpack.js.org/" target="_blank" rel="noopener">webpack</a> (or any other build toolchain), and have followed some <a href="https://www.digitalocean.com/community/tutorials/workflow-publishing-first-package-to-npm" target="_blank" rel="noopener">basic tutorial</a> on publishing an npm package. I also suggest you host your code on GitHub — it has a ton of features useful for OSS, and any other choice is just <em>bizarre</em> in 2021. Let's pick up where you've written some code, pushed it to a public github repo, set up your <code>package.json</code> with <code>name</code>, <code>version</code> and <code>main</code>, and got <code>npm publish</code> to pass. There's still a bumpy ride ahead.</p><p><img src="/images/oss-scream.jpg" alt=""></p><h2>Documentation</h2><p>Your library will be used by people who have no idea what it's supposed to do, and how it works. For a small project, don't block yourself into building a fancy docs website — a <code>readme.md</code> file in the repo root is enough. Writing the actual docs is a better way to spend your time. Make sure to include:</p><ul><li>What problem does your project solve? Does your library do something I need?</li><li>How to install it? Even if it's <code>npm i my-project</code>, don't make me guess the package name.</li><li>A basic usage example. Just something to copy-paste and get started with it.</li><li>Full API docs. What can the library do? Does it cover all my use-cases? What arguments do I pass where? I shouldn't have to read the source to answer these questions.</li></ul><p>See <a href="https://docs.github.com/en/github/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax" target="_blank" rel="noopener">markdown cheatsheet</a> if you're not fluent yet.</p><h2>License</h2><p><em>(I'm not a lawyer, but this is my understanding).</em> A project without an explicit license is closed source by default — the users can look at the code, but can't legally use it. <a href="https://choosealicense.com/" target="_blank" rel="noopener">Choose an open-source license,</a> copy the text into a <code>LICENSE</code> file to your repo, put the name in the <code>license</code> field of <code>package.json</code>, and probably mention it in the readme. <a href="https://mit-license.org/" target="_blank" rel="noopener">MIT license</a> is a good choice if you just want everyone to use your code and don't have a strong opinion on <em>everything must be open-source.</em></p><h2>Package structure</h2><p>When building an app, you have some transpiler + bundler (probably babel + webpack, but anything goes) setup to turn your source into someting that runs in a browser. If you don't want to make your users jump around patching webpack config, you need <em>some</em> of that, too. Exactly <em>how</em> you should package your code is a complex topic, but let me scratch the surface for you. TLDR:</p><ul><li>If you use extended JS (JSX / TS / whatever), or want to support older runtimes with zero setup, do a <code>babel</code> (or friends) pass.</li><li>Have a ES-module build for tree-shaking, and a legacy CommonJS build.</li><li>Be clear about supported browsers / node versions. Too much = bloat, too little = broken apps for users who don't do extra setup (they won't).</li><li>Never use global polyfills, and prefer well-supported APIs when possible.</li><li>Don't bother bundling.</li></ul><p>Just a touch deeper:</p><h3>Transpiling</h3><p>The code you ship <em>must</em> be standard ES to &quot;just work&quot; for your users. Convert JSX / TypeScript / Vue SFC / other fancy syntax down to JS with <code>babel</code>, <code>tsc</code>, or whatever <code>esbuild</code> you enjoy, and point <code>main</code> to the built version instead of your raw source.</p><p>The exact ES target (ES2020 / 6 / 5) is up to you — pick a browser / node target and stick to it. Your users <em>can</em> transpile further down, if they're determined, but undoing an unnecessary transform is next to impossible — it becomes bloat in the final app. Also, some babel transforms (like <a href="https://babeljs.io/docs/en/babel-plugin-transform-unicode-regex" target="_blank" rel="noopener">unicode regex</a>) are <em>very</em> verbose — have a look at the generated code once in a while.</p><p>The most important question is what to do with <code>import / export</code>. Read on.</p><h3>Tree-shaking</h3><p>If your library runs in a browser, and it does more than <em>one</em> thing, you'd better support <a href="https://webpack.js.org/guides/tree-shaking/" target="_blank" rel="noopener">tree shaking</a> — otherwise, every app using your library will ship useless dead code to the end users' browsers. To get started, create a modular build:</p><ul><li>Set <code>modules: false</code> in <a href="https://babeljs.io/docs/en/babel-preset-env#modules" target="_blank" rel="noopener"><code>@babel/preset-env</code> config</a> to preserve <code>import / export</code></li><li>Add <code>&quot;sideEffects&quot;: false</code> or <a href="https://webpack.js.org/guides/tree-shaking/#mark-the-file-as-side-effect-free" target="_blank" rel="noopener">list your side-effect modules</a> explicitly in <code>package.json</code>.</li><li>Point the <a href="https://webpack.js.org/guides/author-libraries/#final-steps" target="_blank" rel="noopener">non-standard <code>module</code></a> field of <code>package.json</code> to the resulting entrypoint.</li></ul><p>Now a module-capable bundler can pick it up and remove unused code from the final bundle. Cool.</p><p>However, node &lt;= 12 does not support import / export syntax <em>without a flag</em>. I'm lost in all the <a href="https://nodejs.org/api/esm.html" target="_blank" rel="noopener">new <code>&quot;type&quot;: &quot;module&quot;</code> / <code>&quot;.mjs&quot;</code></a>, but shipping a <a href="https://web.dev/publish-modern-javascript/#modern-with-legacy-fallback" target="_blank" rel="noopener">fallback CommonJS build</a> works fine in all node versions and older bundlers. For a library that works both client- and server-side, keep a CommonJS (<code>exports / require</code>) version (generated with a <a href="https://babeljs.io/docs/en/babel-preset-env#modules" target="_blank" rel="noopener">pass of babel</a> with <code>modules: 'commonjs'</code>), referenced in <code>main</code> field of <code>package.json</code>.</p><p>There's more to tree shaking — some patterns are not tree-shakable, it affects your API choices, complex topic. We'll save for it later — supporting basic tree-shaking with ES modules is always a good start.</p><h3>Polyfills</h3><p>Should your library include the polyfills for recent browser APIs you use? It's a <a href="https://github.com/w3ctag/polyfills/issues/6" target="_blank" rel="noopener">surprisingly debatable issue</a> among OSS authors. Problem, short version: in most app setups, <code>babel</code> doesn't process <code>node_modules</code>, possibly breaking the final app in older browsers. <em>But</em> if you include a polyfill, removing it is from an app that only targets modern browsers is super hard. Also, the final bundle is likely to contain duplicate polyfills of one API.</p><p>I'll stick with <a href="https://github.com/w3ctag/polyfills/issues/6#issuecomment-272222513" target="_blank" rel="noopener">Rich</a> <a href="https://github.com/w3ctag/polyfills/issues/6#issuecomment-272651240" target="_blank" rel="noopener">Harris</a> on this one:</p><ul><li><em>Never</em> include global polyfills that patch <code>BuiltIn.prototype</code> or <code>window</code> — they can clash with other global polyfills, and are not tree-shakable.</li><li>Use helper functions (aka <a href="https://ponyfill.com" target="_blank" rel="noopener"><em>ponyfills</em></a>) like <code>export function startsWith</code> if for code reuse.</li><li>Prefer well-supported APIs if possible — using <code>str.indexOf(...) === 0</code> instead of <code>startsWith</code> is not <em>that</em> hard.</li><li>Clearly say what targets you support in the readme. Don't pretend to support IE11 if you're not very serious. Maybe provide instructions on setting up <code>babel-loader</code> to process your library.</li></ul><h3>Bundling</h3><p>You <em>could</em> bundle your code, but I think it creates more problems than it solves at the start. How to exclude your dependencies from the bundle? What <code>libraryTarget</code> do you need? Are we sure bundling does not accidentally create non-tree-shakable logic? I'd stick with babel CLI and ship the code as separate JS files: <code>npx babel src --out-dir dist</code>.</p><h2>Typings</h2><p>TypeScript is a major player in the JS ecosystem these days. Libraries without TS types explode in TS projects with <code>Could not find a declaration file for module '...'</code>, forcing users to either <code>@ts-ignore</code> it or slap together custom ambient declarations. Some lazier developers will probably move to the next library, and I won't blame them.</p><p><img src="/images/no-dts.png" alt=""></p><p>Shipping TS types is actually easy: if you write in TypeScript, <code>tsc --declaration</code> (<code>--declarationOnly</code> if you build with babel, see <a href="https://www.typescriptlang.org/tsconfig#declaration" target="_blank" rel="noopener">docs</a>) into your build folder. If you write pure JS, it's even easier — just write a custom <code>index.d.ts</code> file describing your library, and copy it to build folder. Now point <code>types</code> field in <code>package.json</code> to the declaration entry point, and you're all set! Don't worry about <code>@types/*</code> pacakges for now. See full <a href="https://www.typescriptlang.org/docs/handbook/declaration-files/publishing.html#including-declarations-in-your-npm-package" target="_blank" rel="noopener">TS docs on publishing</a> if you have any trouble.</p><p>I don't know much about Flow, and no one ever asked me to support it, but if you're a fan, see <a href="https://stackoverflow.com/questions/61889988/exporting-my-own-flow-type-with-npm-package" target="_blank" rel="noopener">SO tips on doing that.</a></p><h2>Understand dependencies vs dev/peerDependencies</h2><p>In app development <code>dependencies</code> (<code>npm i</code>) vs <code>devDependenices</code> (<code>npm i --dev</code>) is not a real issue — sure, <code>dev</code> is for your build pipeline, <code>dependencies</code> for real runtime libraries, but it mostly works fine if you mess up. The difference is critical for libraries, though:</p><ul><li><code>devDependencies</code> are not installed after <code>npm i your-lib</code>.</li><li><code>dependencies</code> are automatically installed along with your package. If the user (or some other package) requests a different version of the same dependency, they may get duplicated, but at least it usually works.</li><li><code>peerDependencies</code> allow you to reference a package explicitly installed by your users. This ensures the dependency instance is shared between user code and your library, which is crucial for <em>plugins</em> — react components, express middlewares, etc. In effect, this forces a single dependency version per app — your users can't upgrade to react 18 until you support it. Assume the users have to install peers manually — sure, npm 7+ installs <a href="https://github.blog/2021-02-02-npm-7-is-now-generally-available/#peer-dependencies" target="_blank" rel="noopener">them automatically</a>, but <a href="https://github.com/yarnpkg/yarn/issues/1503" target="_blank" rel="noopener">yarn</a> and <a href="https://github.com/pnpm/pnpm/issues/827" target="_blank" rel="noopener">pnpm</a> don't. People hate manually installing stuff they don't care about to get the project to build, so don't overuse peers.</li><li><a href="https://docs.npmjs.com/cli/v8/configuring-npm/package-json#bundleddependencies" target="_blank" rel="noopener">bundledDependencies</a> and <a href="https://docs.npmjs.com/cli/v8/configuring-npm/package-json#optionaldependencies" target="_blank" rel="noopener">optionalDependencies?</a> You don't need them.</li></ul><p>Basic guideline: all the runtime dependencies go into <code>dependencies</code>. <em>Plugins</em> should put the main library into <code>peerDependencies</code>.</p><h2>Changelog</h2><p>I install your library, and I'm happy with it. Some time later, it's friday evening and I can't get real job done any more. I decide to update my dependencies, and discover that your library moved from <code>1.0.3</code> to <code>2.3.0</code>.</p><ul><li>Have you fixed some important bugs, so that I need to update <strong>right now</strong>?</li><li>Have you added new features I might enjoy?</li><li>What's the breaking change in v2, and how do I update?</li></ul><p>To answer these questions, I'd love to see a changelog saying what changed in every version since <code>1.0.3</code>. Both <a href="https://docs.github.com/en/repositories/releasing-projects-on-github/about-releases" target="_blank" rel="noopener">GH releases</a> and a <code>CHANGELOG.md</code> in the root work fine. Otherwise, I'll have to read the commit / PR list, which is likely to make me very sad.</p><hr><p>So, here's my list of stuff to keep in mind when publishing a JS library:</p><p>Must have:</p><ol><li>A readme with a problem statement, installation command, hello world example, and full API docs.</li><li>A license: full text in project root, name in the readme and in <code>package.json</code></li><li>TS typings (unless it's a CLI tool).</li><li>Changelog in GH releases or a <code>changelog.md</code>.</li></ol><p>Managing dependencies:</p><ol><li>Runtime <code>dependencies</code> go into <code>package.json</code></li><li><em>Plugins</em> make the <em>master library</em> a <code>peerDependency</code></li></ol><p>Build setup:</p><ol><li>Transpile the code to standard JS.</li><li>Running in browsers? Ship es-modules entrypoint in <code>package.json</code> <code>modules</code> for tree shaking.</li><li>Running on node? Ship CommonJS entrypoint in <code>main</code>.</li><li>Avoid global polyfills.</li><li>Don't bundle.</li></ol></div><span class="share"><div><a href="https://twitter.com/share?url=https://thoughtspile.github.io/2021/11/20/open-source-starter/&text=Open source starter pack for JS devs by @thoughtspile" target="_blank" rel="noopener">Tweet</a></div><div id="share-button"><a>Share</a></div><div><a href="https://twitter.com/search?q=https://thoughtspile.github.io/2021/11/20/open-source-starter/" target="_blank" rel="noopener">Discuss on Twitter</a></div></span><div class="social-links"><a href="https://twitter.com/thoughtspile" class="link--bare" target="_blank" rel="noopener"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="https://mastodon.online/@thoughtspile" class="link--bare" target="_blank" rel="noopener"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="mastodon" class="svg-inline--fa fa-mastodon fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"></path></svg></a><a href="https://www.linkedin.com/in/vklepov/" class="link--bare" target="_blank" rel="noopener"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a href="/atom.xml" class="link--bare" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="rss" class="svg-inline--fa fa-rss fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 64C0 46.3 14.3 32 32 32c229.8 0 416 186.2 416 416c0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96C14.3 96 0 81.7 0 64zM128 416c0 35.3-28.7 64-64 64s-64-28.7-64-64s28.7-64 64-64s64 28.7 64 64zM32 160c159.1 0 288 128.9 288 288c0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224c-17.7 0-32-14.3-32-32s14.3-32 32-32z"></path></svg></a></div><a href="https://buymeacoffee.com/thoughtspile" class="link--bare bmc-card" target="_blank" rel="noopener"><div><b>Hello, friend!</b> My name is Vladimir, and I love writing about web development. If you got down here, you probably enjoyed this article. My goal is to become an independent content creator, and you'll help me get there by <span class="bmc">buying me a coffee!</span></div><img src="/images/bmc.png" data-no-preview class="bmc-image"></a><div class="post-related"><div class="post-sibling"><span class="post-siblings__direction">More?</span> <a class="tag-link-link" href="/">All articles ever</a> <a class="tag-link-link" href="/tags/open source" rel="tag">open source</a> <a class="tag-link-link" href="/tags/javascript" rel="tag">javascript</a></div><a class="link--bare post-sibling" href="/2021/11/15/unintentional-layout-effect/"><span class="post-siblings__direction">Older?</span> <span class="link__text">useEffect sometimes fires before paint</span> </a><a class="link--bare post-sibling" href="/2021/11/30/lazy-useref/"><span class="post-siblings__direction">Newer?</span> <span class="link__text">Make useRef lazy — 4 ways</span></a></div></article><script async src="/js/share.js"></script></div></body></html>