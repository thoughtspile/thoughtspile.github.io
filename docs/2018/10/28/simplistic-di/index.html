<!doctype html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="yandex-verification" content="635edef3908320be"><meta name="google-site-verification" content="1-m0w7Up8df1sn0230jxfTKKZ4jLeln_Em1tcyfU0qw"><meta name="color-scheme" content="dark light"><meta property="og:type" content="article"><meta property="og:title" content="OOP for FP lovers: Simplistic Dependency Injection"><meta property="og:url" content="https://thoughtspile.github.io/2018/10/28/simplistic-di/"><meta property="og:site_name" content="Vladimir Klepov as a Coder"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://thoughtspile.github.io/images/main-promo.png"><meta property="article:published_time" content="2018-10-28T00:00:00.000Z"><meta property="article:author" content="Vladimir Klepov"><meta property="article:tag" content="javascript"><meta property="article:tag" content="programming"><meta property="article:tag" content="OOP"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@thoughtspile"><meta name="twitter:image" content="https://thoughtspile.github.io/images/main-promo.png"><title>OOP for FP lovers: Simplistic Dependency Injection</title><link rel="stylesheet" href="/css/style.css?ts=1705835725288"><link rel="canonical" href="https://thoughtspile.github.io/2018/10/28/simplistic-di/"><link rel="alternate" href="/atom.xml" title="Vladimir Klepov as a Coder" type="application/atom+xml"><script defer="defer" data-domain="thoughtspile.github.io" src="https://t.thoughtspile.tech/js/script.js"></script></head><body class="max-width mx-auto px3"><div class="content index"><a href="/" id="header" class="header header--post"><div id="logo"></div><header id="title"><h1>Vladimir Klepov as a Coder</h1></header></a><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">OOP for FP lovers: Simplistic Dependency Injection</h1><div class="post__date">Written in <time>2018</time></div></header><div class="content" itemprop="articleBody"><p>With all the enthusiasm around functional design in javascript community, we've come to reject the concepts whose names remind us of object-orientation. We throw constructors, methods and classes out of the window because they seem to smell of bank cubicles, water coolers and ERP. I've been on that train, but now I'm free from the prejudice. Great, useful ideas are hidden inside the fancy OOP terming, and I'm here to expose their niceness. We shall begin with Dependency Injection.</p><h2>We Have a Problem</h2><p>I hear your teeth cringe as dusty IoC containers and AngularJS fly around your head. Take a deep breath and bear with me. Let's write a module, say, a User service, that <em>depends</em> on other modules — a requester and the config. Normally, we code it along the lines of (for some imaginary redux-like state manager):</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> getUserList <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./getUserList'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">pageSize</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'192.168.0.0'</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">initState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">users</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">loadNextUsers</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token literal-property property">limit</span><span class="token operator">:</span> config<span class="token punctuation">.</span>pageSize<span class="token punctuation">,</span><br>    <span class="token literal-property property">offset</span><span class="token operator">:</span> state<span class="token punctuation">.</span>users<span class="token punctuation">.</span>length<span class="token punctuation">,</span><br>    <span class="token literal-property property">host</span><span class="token operator">:</span> config<span class="token punctuation">.</span>host<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">nextUsers</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    state<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>nextUsers<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>The dependency structure of this app is set in stone, allowing no fiddling. It causes two classic problems. The module is not too reusable: we can't customize the page size or host when loading the users. Testablity could be better, too: while we could have a <code>getUserList.mock.js</code> lying around for testing, replacing <code>config</code> in module's internal scope is probably excessively tricky, even if possible.</p><h2>STEP! Enter DI.</h2><p>If we have <em>dependencies</em>, we can <em>inject</em> them! All it takes in our functional example is passing them to <code>loadNextUsers</code> as a parameter:</p><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">initState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">users</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">loadNextUsers</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> getUserList<span class="token punctuation">,</span> config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token literal-property property">limit</span><span class="token operator">:</span> config<span class="token punctuation">.</span>pageSize<span class="token punctuation">,</span><br>    <span class="token literal-property property">offset</span><span class="token operator">:</span> state<span class="token punctuation">.</span>users<span class="token punctuation">.</span>length<span class="token punctuation">,</span><br>    <span class="token literal-property property">host</span><span class="token operator">:</span> config<span class="token punctuation">.</span>host<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">nextUsers</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    state<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>nextUsers<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>That's not a huge change: instead of explicitly specifying and importing the dependencies inside a module, we do it one level above. By the way, <code>state</code> was injectable from the beginnning, allowing us to play with it or create multiple instances.</p><p>At first, it might seem like added verbosity and bookkeeping. But hey, look at the upsides! Now we can override the config as much as we like when loading the users: vary page size and the host (frankly, the host setting is a bit silly, but I couldn't think of anything better — just pretend it's super useful).</p><p>Testing becomes a joy. Instead of using a magic loader that takes not-the-module-we-specify-but-the-one-with-<code>.mock</code>-added-if-there-is-one, we can just call our function directly with a mocked dependency, using <a href="https://www.node-tap.org/" target="_blank" rel="noopener">node-tap</a> or even a bunch of <code>assert</code>s.</p><p>And the best thing is — we can use the explicit dependencies from the first example as default parameters, combining the best of both approaches.</p><p>This spirit of DI is what separates</p><ul><li><code>sum([1,2,3,4])</code> from <code>reduce([1,2,3,4], (x, y) =&gt; x + y, 0)</code> — we <em>inject</em> the reducer and the initial value.</li><li><code>mongoose</code> from <code>new Mongoose()</code> — this is brilliant API design, giving you ease of use for the 90% use case while providing an escape hatch to <em>inject</em> <a href="https://stackoverflow.com/questions/19474712/mongoose-and-multiple-database-in-single-node-js-project#19475270" target="_blank" rel="noopener">multiple databases</a> if you need to.</li><li><code>alias: { 'react': 'preact-compat' }</code> in webpack from <code>@tappable({ h })</code> — yes, JSX-based helper libraries would have made us a favor by allowing to <em>inject</em> the JSX provider instead of relying on bundler trickery.</li></ul><h2>Are We Done Yet?</h2><p>Our homegrown DI is not perfect — it has problems of its own compared to real IoC containers, such as <a href="http://inversify.io/">InversifyJS</a>. The more stuff we inject, the more positional arguments we have to pass around, which becomes painful. Moreover, somewhere in our code we are still bound to the physical location of source modules, importing and repeating ourselver over and over. So yes, real, unhip, enterprise flavor of DI solves real problems.</p><hr><p>Please take some time to think it all over. DI is good. OOP is even better. They have non-hacky solutions to real challenges. Had it for over 20 years now, just sitting around. FP is good, too, for the same reason — not because of <em>elegance</em>, whatever that means. Meanwhile, I'll try to write more on the merits of loosely-understood OOP, so make sure to come back!</p></div><span class="share"><div><a href="https://twitter.com/share?url=https://thoughtspile.github.io/2018/10/28/simplistic-di/&text=OOP for FP lovers: Simplistic Dependency Injection by @thoughtspile" target="_blank" rel="noopener">Tweet</a></div><div id="share-button"><a>Share</a></div><div><a href="https://twitter.com/search?q=https://thoughtspile.github.io/2018/10/28/simplistic-di/" target="_blank" rel="noopener">Discuss on Twitter</a></div></span><div class="social-links"><a href="https://twitter.com/thoughtspile" class="link--bare" target="_blank" rel="noopener"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="https://mastodon.online/@thoughtspile" class="link--bare" target="_blank" rel="noopener"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="mastodon" class="svg-inline--fa fa-mastodon fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"></path></svg></a><a href="https://www.linkedin.com/in/vklepov/" class="link--bare" target="_blank" rel="noopener"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a href="/atom.xml" class="link--bare" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="rss" class="svg-inline--fa fa-rss fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 64C0 46.3 14.3 32 32 32c229.8 0 416 186.2 416 416c0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96C14.3 96 0 81.7 0 64zM128 416c0 35.3-28.7 64-64 64s-64-28.7-64-64s28.7-64 64-64s64 28.7 64 64zM32 160c159.1 0 288 128.9 288 288c0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224c-17.7 0-32-14.3-32-32s14.3-32 32-32z"></path></svg></a></div><a href="https://buymeacoffee.com/thoughtspile" class="link--bare bmc-card" target="_blank" rel="noopener"><div><b>Hello, friend!</b> My name is Vladimir, and I love writing about web development. If you got down here, you probably enjoyed this article. My goal is to become an independent content creator, and you'll help me get there by <span class="bmc">buying me a coffee!</span></div><img src="/images/bmc.png" data-no-preview class="bmc-image"></a><div class="post-related"><div class="post-sibling"><span class="post-siblings__direction">More?</span> <a class="tag-link-link" href="/">All articles ever</a> <a class="tag-link-link" href="/tags/javascript" rel="tag">javascript</a> <a class="tag-link-link" href="/tags/programming" rel="tag">programming</a> <a class="tag-link-link" href="/tags/OOP" rel="tag">OOP</a></div><a class="link--bare post-sibling" href="/2018/10/05/js-debug-logging/"><span class="post-siblings__direction">Older?</span> <span class="link__text">Five Tricks for Debug-Logging in JavaScript</span> </a><a class="link--bare post-sibling" href="/2018/11/05/react-extend-justified/"><span class="post-siblings__direction">Newer?</span> <span class="link__text">Why you Might Want to Extend React Components</span></a></div></article><script async src="/js/share.js"></script></div></body></html>