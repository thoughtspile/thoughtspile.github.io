<!doctype html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="yandex-verification" content="635edef3908320be"><meta name="google-site-verification" content="1-m0w7Up8df1sn0230jxfTKKZ4jLeln_Em1tcyfU0qw"><meta property="og:type" content="article"><meta property="og:title" content="OOP for FP lovers: Simplistic Dependency Injection"><meta property="og:url" content="https://blog.thoughtspile.tech/2018/10/28/simplistic-di/"><meta property="og:site_name" content="Vladimir Klepov as a Coder"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2018-10-28T00:00:00.000Z"><meta property="article:author" content="Vladimir Klepov"><meta property="article:tag" content="javascript"><meta property="article:tag" content="programming"><meta property="article:tag" content="OOP"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@thoughtspile"><title>OOP for FP lovers: Simplistic Dependency Injection</title><link rel="stylesheet" href="/css/style.css"><link rel="canonical" href="https://blog.thoughtspile.tech/2018/10/28/simplistic-di/"><link rel="alternate" href="/atom.xml" title="Vladimir Klepov as a Coder" type="application/atom+xml"><script defer="defer" data-domain="blog.thoughtspile.tech" src="http://172.105.67.233/js/script.js"></script></head><body class="max-width mx-auto px3"><div class="content index"><a href="/" id="header" class="header header--post"><div id="logo"></div><header id="title"><h1>Vladimir Klepov as a Coder</h1></header></a><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">OOP for FP lovers: Simplistic Dependency Injection</h1></header><div class="content" itemprop="articleBody"><p>With all the enthusiasm around functional design in javascript community, we've come to reject the concepts whose names remind us of object-orientation. We throw constructors, methods and classes out of the window because they seem to smell of bank cubicles, water coolers and ERP. I've been on that train, but now I'm free from the prejudice. Great, useful ideas are hidden inside the fancy OOP terming, and I'm here to expose their niceness. We shall begin with Dependency Injection.</p><h2>We Have a Problem</h2><p>I hear your teeth cringe as dusty IoC containers and AngularJS fly around your head. Take a deep breath and bear with me. Let's write a module, say, a User service, that <em>depends</em> on other modules — a requester and the config. Normally, we code it along the lines of (for some imaginary redux-like state manager):</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> getUserList <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./getUserList'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">pageSize</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'192.168.0.0'</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">initState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">users</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">loadNextUsers</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token literal-property property">limit</span><span class="token operator">:</span> config<span class="token punctuation">.</span>pageSize<span class="token punctuation">,</span><br>    <span class="token literal-property property">offset</span><span class="token operator">:</span> state<span class="token punctuation">.</span>users<span class="token punctuation">.</span>length<span class="token punctuation">,</span><br>    <span class="token literal-property property">host</span><span class="token operator">:</span> config<span class="token punctuation">.</span>host<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">nextUsers</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    state<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>nextUsers<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>The dependency structure of this app is set in stone, allowing no fiddling. It causes two classic problems. The module is not too reusable: we can't customize the page size or host when loading the users. Testablity could be better, too: while we could have a <code>getUserList.mock.js</code> lying around for testing, replacing <code>config</code> in module's internal scope is probably excessively tricky, even if possible.</p><h2>STEP! Enter DI.</h2><p>If we have <em>dependencies</em>, we can <em>inject</em> them! All it takes in our functional example is passing them to <code>loadNextUsers</code> as a parameter:</p><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">initState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">users</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">loadNextUsers</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> getUserList<span class="token punctuation">,</span> config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token literal-property property">limit</span><span class="token operator">:</span> config<span class="token punctuation">.</span>pageSize<span class="token punctuation">,</span><br>    <span class="token literal-property property">offset</span><span class="token operator">:</span> state<span class="token punctuation">.</span>users<span class="token punctuation">.</span>length<span class="token punctuation">,</span><br>    <span class="token literal-property property">host</span><span class="token operator">:</span> config<span class="token punctuation">.</span>host<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">nextUsers</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    state<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>nextUsers<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>That's not a huge change: instead of explicitly specifying and importing the dependencies inside a module, we do it one level above. By the way, <code>state</code> was injectable from the beginnning, allowing us to play with it or create multiple instances.</p><p>At first, it might seem like added verbosity and bookkeeping. But hey, look at the upsides! Now we can override the config as much as we like when loading the users: vary page size and the host (frankly, the host setting is a bit silly, but I couldn't think of anything better — just pretend it's super useful).</p><p>Testing becomes a joy. Instead of using a magic loader that takes not-the-module-we-specify-but-the-one-with-<code>.mock</code>-added-if-there-is-one, we can just call our function directly with a mocked dependency, using <a href="https://www.node-tap.org/" target="_blank" rel="noopener">node-tap</a> or even a bunch of <code>assert</code>s.</p><p>And the best thing is — we can use the explicit dependencies from the first example as default parameters, combining the best of both approaches.</p><p>This spirit of DI is what separates</p><ul><li><code>sum([1,2,3,4])</code> from <code>reduce([1,2,3,4], (x, y) =&gt; x + y, 0)</code> — we <em>inject</em> the reducer and the initial value.</li><li><code>mongoose</code> from <code>new Mongoose()</code> — this is brilliant API design, giving you ease of use for the 90% use case while providing an escape hatch to <em>inject</em> <a href="https://stackoverflow.com/questions/19474712/mongoose-and-multiple-database-in-single-node-js-project#19475270" target="_blank" rel="noopener">multiple databases</a> if you need to.</li><li><code>alias: { 'react': 'preact-compat' }</code> in webpack from <code>@tappable({ h })</code> — yes, JSX-based helper libraries would have made us a favor by allowing to <em>inject</em> the JSX provider instead of relying on bundler trickery.</li></ul><h2>Are We Done Yet?</h2><p>Our homegrown DI is not perfect — it has problems of its own compared to real IoC containers, such as <a href="http://inversify.io/">InversifyJS</a>. The more stuff we inject, the more positional arguments we have to pass around, which becomes painful. Moreover, somewhere in our code we are still bound to the physical location of source modules, importing and repeating ourselver over and over. So yes, real, unhip, enterprise flavor of DI solves real problems.</p><hr><p>Please take some time to think it all over. DI is good. OOP is even better. They have non-hacky solutions to real challenges. Had it for over 20 years now, just sitting around. FP is good, too, for the same reason — not because of <em>elegance</em>, whatever that means. Meanwhile, I'll try to write more on the merits of loosely-understood OOP, so make sure to come back!</p></div><span class="share"><div><a href="https://twitter.com/share?url=&text= by @thoughtspile" target="_blank" rel="noopener">Tweet</a></div><div id="share-button"><a>Share</a></div><div><a href="https://twitter.com/search?q=https://blog.thoughtspile.tech/2018/10/28/simplistic-di/" target="_blank" rel="noopener">Discuss on Twitter</a></div></span><div class="post-related">More? <a class="tag-link-link" href="/">All articles ever</a> <a class="tag-link-link" href="/tags/javascript" rel="tag">javascript</a> <a class="tag-link-link" href="/tags/programming" rel="tag">programming</a> <a class="tag-link-link" href="/tags/OOP" rel="tag">OOP</a></div><div class="post-actions">Written in <time>2018</time> by&nbsp;your friend, <a href="/">Vladimir.</a> Follow&nbsp;me on&nbsp;<a href="https://twitter.com/thoughtspile" target="_blank" rel="noopener">Twitter</a> to&nbsp;get post updates. I&nbsp;have <a href="/atom.xml">RSS,</a> too. And you can <a class="bmc link--bare" href="https://buymeacoffee.com/thoughtspile" target="_blank" rel="noopener">buy me a coffee!</a></div><div class="post-siblings"><a class="link--bare" href="/2018/10/05/js-debug-logging/"><div class="post-siblings__direction">Older</div><span class="link__text">Five Tricks for Debug-Logging in JavaScript</span> </a><a class="link--bare" href="/2018/11/05/react-extend-justified/"><div class="post-siblings__direction">Newer</div><span class="link__text">Why you Might Want to Extend React Components</span></a></div></article><script async src="/js/share.js"></script></div></body></html><script type="text/javascript">(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-121445688-1', 'auto');
    ga('send', 'pageview');</script>